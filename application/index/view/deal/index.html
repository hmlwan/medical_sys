<!DOCTYPE html>
<html lang="en">
<head>
    <!--申明当前页面的编码集-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!--网页标题-->
    <title>求购列表</title>
    {include file="layout/head" /}
</head>
<body>
<div class="wym-page">
    <input type="hidden" name="mui-tab-item" value="3">
    <div class="wym_header">
        <div class="wym_header_top flexbox wrap space-between relative">
            <p><a href="javascript:location.reload();"><i class="refresh_icon"></i></a></p>
            <p class="flexbox wrap spacearound">
                <span class="active">我要卖</span>
               <span id="buy">我要买</span>
            </p>
            <p class="flexbox wrap spacearound">
                {if $is_finish_trade == 1}
                <!--<i class="red_icon"></i>-->
                {/if}
                <a href="{:url('order/index')}" class="flexbox column">
                    <i class="dd_icon"></i>
                    <span>订单</span>
                </a>
                <a href="/index/index/articleinfo?articleId=6" class="flexbox column">
                    <i class="sz_icon"></i>
                    <span>说明</span>
                </a>
            </p>
        </div>
        <div class="wym_header_mid flexbox wrap spacebetween">
            <!--<span style="display: none"></span>-->
            <span class="span_line">
                 <span class="scroll">
                    <!--<em>交易完成总数量:{$finish_order_sum_num}</em>-->
                    <em>等待匹配:{$default_order_sum_num}</em>
                </span>
            </span>
            <span class="span_line">
                {if $is_fill == 1}
                    <input type="text" class="input_line" value="{$Think.get.mobile}" readonly name="mobile" placeholder="可出售{$fill_sale}糖果"> <i class="ss_icon" id="search"></i>
                {else /}
                     <input type="text" class="input_line" value="{$Think.get.mobile}" readonly name="mobile" placeholder="不符合出售条件"> <i class="ss_icon" id="search"></i>
                {/if}
            </span>
        </div>
    </div>
    {if $web_switch_market  != 1  }
        <div class="show_on_content">
            <p><img src="/static/img/newimg/sd2.png" alt=""></p>
            <p class="show_text blod" style="color: #000;font-size: .3rem">暂停交易，等待10号新版本更新。</p>
        </div>
    {elseif $is_stop_deal  == 1}
        <div class="show_on_content">
            <p><img src="/static/img/newimg/sd2.png" alt=""></p>
            <p class="show_text blod" style="color: #000;font-size: .3rem">休市中</p>
            <p class="show_text" style="font-size: .23rem">交易时间:{$web_start_time}-{$web_end_time}</p>
        </div>
    {else /}
        {if count($list) > 0}
        <div class="wym_content flow_load">
            {foreach $list as $item}

            {/foreach}
        </div>
        {else /}
            <div class="show_on_content">
                <p><img src="/static/img/newimg/no_data_icon.png" alt=""></p>
                <p class="show_text">暂无内容</p>
            </div>
        {/if}
    {/if}
</div>
<div class="order_tips_pop cs_pop" style="display: none">
    <input type="hidden" name="order_id" value="">
    <div class="order_tips_pop_view">
        <p class="title">卖出提示</p>
        <!--<p>是否出售 <em class="number">0</em>糖果换取<em class="china_price">0.00</em>元</p>-->
              <p>是否出售 <em class="number">0</em>糖果(出售手续费为18%)</p>
        <p class="btn text_center">
            <span class="confirm float_l">确定</span>
            <span class="cancel float_r">取消</span>
        </p>
    </div>
</div>
<div class="order_tips_pop jf_pop" style="display: none">
    <div class="order_tips_pop_view">
        <p class="title">解封提示</p>
        <p>您有匹配成功的买入订单未及时付款，需缴纳{$trade_fine_num}糖果作为罚金才能开放交易</p>
        <p class="btn">
            <span class="confirm float_l">确定</span>
            <span class="cancel float_r">取消</span>
        </p>
    </div>
</div>
<div class="order_tips_pop ye_pop" style="display: none">
    <div class="order_tips_pop_view">
        <p class="title">余额不足</p>
        <p>您的账户余额不足{$trade_fine_num}糖果不能解封，您可以在问题反馈页面联系客服解封，仅只有一次机会。</p>
        <p class="btn text_center">
            <span>确定</span>
        </p>
    </div>
</div>
<div class="order_tips_pop ch_pop" style="display: none">
    <div class="order_tips_pop_view">
        <p class="title">解封成功</p>
        <p>您已经解封成功了，多次匹配恶意不付款将会永久封停不可解封，请知晓</p>
        <p class="btn text_center">
            <span>确定</span>
        </p>
    </div>
</div>
<div class="announcement_pop" style="display: none">
    <img src="/static/img/newimg/g11.jpg" alt="">
</div>

<div class="zhezhao_h zhezhao"></div>

{include file="layout/footer" /}
{include file="layout/nav" /}
<script>
    lazy_loading('index?mobile={$Think.get.mobile}');
    document.getElementById('buy').addEventListener('tap', function () {
        mui.openWindow({
            url: "{:url('buy_list')}",
            id: 'buy',

        })
    });
    $(".announcement_pop").click(function () {
        $(".zhezhao_h").removeClass('zhezhao');
        $(".announcement_pop").hide();
    })
    var is_order_status = "{$order_status}";
    if(is_order_status == -1){
        $(".zhezhao_h").addClass('zhezhao');
        $(".jf_pop").show();
    }else{
        $(".zhezhao_h").addClass('zhezhao');
        $(".announcement_pop").show();
    }
    $(".jf_pop .cancel,.ye_pop .text_center").click(function () {
        window.location.href = '/index/member/index';
    });
    $(".ch_pop .text_center").click(function () {
        $(".order_tips_pop").hide();
        $(".zhezhao_h").removeClass('zhezhao');
        window.location.reload();
    });
    /*解封*/
    $(".jf_pop .confirm").click(function () {

        mui.showLoading("处理中..", "div");
        $.ajax({
            url:"/index/order/unblock",
            type:"post",
            data:{
            },
            dataType:'json',
            success:function(data){
                mui.hideLoading();
                $(".zhezhao_h").removeClass('zhezhao');
                $(".jf_pop").show();
                if(data.code == 0)
                {
                    $(".zhezhao_h").addClass('zhezhao');
                    $(".ch_pop").show();
                }else if(data.code == 2){
                    $(".zhezhao_h").addClass('zhezhao');
                    $(".ye_pop").show();
                }else{
                    mui.alert(data.message);
                    return false;
                }
            }
        })
    });


    $("#search").click(function () {
//        var mobile = $("input[name='mobile']").val();
        window.location.href = '/index/member/assets';
        return false;
    });
    //出售
    $(".cs_pop .confirm").click(function () {
        var order_id = $("input[name='order_id']").val();
        mui.showLoading("处理中..", "div");
        $.ajax({
            url:"sale",
            type:"post",
            data:{
                order_id:order_id
            },
            dataType:'json',
            success:function(data){
                mui.hideLoading();
                $(".zhezhao_h").removeClass('zhezhao');
                $(".cs_pop").hide();
                if(data.code == 0)
                {
                    mui.alert(data.message,function () {
                        window.location.href = '/index/order/index';
                    });
                }else{
                    if(data.toUrl){
                        mui.alert(data.message,function () {
                            window.location.href = data.toUrl;
                        });
                    }else{
                        mui.alert(data.message);
                        return false;
                    }

                }
            }
        })
    });
    //取消
    $(".cs_pop .cancel").click(function () {
        $(".order_tips_pop").hide();
        $(".zhezhao_h").removeClass('zhezhao');
    });
    function ajaxSale(order_id,total_number,china_price) {
        if(!order_id){
            mui.alert("订单不存在");
            return false;
        }
        $("input[name='order_id']").val(order_id);
        $(".cs_pop .number").text(total_number);
        // $(".cs_pop .china_price").text(china_price);
        $(".cs_pop").show();
        $(".zhezhao_h").addClass('zhezhao');


    }
    scroll();
    var $wrapper = $(".span_line"),
            $ul = $wrapper.find('.scroll'),
            $li = $wrapper.find('em');
    var srollDistance = $li.height() * $li.length;
    console.log(srollDistance);
    var cloneFirst = $ul.children(':nth-child(1)').clone();
    $ul.append(cloneFirst)
    function scroll() {
        var timer = setInterval(function() {
            var scrollDis = +$ul[0].offsetTop - $li.height();
            console.log(scrollDis);
            $ul.animate({
                top: scrollDis + 'px'
            }, function() {
                if (Math.abs(scrollDis) >= srollDistance) {
                    $ul.css('top', '0px')
                }
            })
        }, 3000)
    }

</script>
</body>
</html>
